From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: "Xymb (aider)" <xymb@endcrystal.me>
Date: Fri, 13 Sep 2024 14:43:03 +0200
Subject: [PATCH] Fix: Trim nbt.toString() to max 1000 characters in
 ItemStack's error message


diff --git a/src/main/java/net/minecraft/world/item/ItemStack.java b/src/main/java/net/minecraft/world/item/ItemStack.java
index 72dcf1188cc6d3d4c000972c4b5691a4da5becec..b8dad338540b734ec19e404b9c1ff57385702af0 100644
--- a/src/main/java/net/minecraft/world/item/ItemStack.java
+++ b/src/main/java/net/minecraft/world/item/ItemStack.java
@@ -375,7 +375,11 @@ public final class ItemStack implements DataComponentHolder {
         }
 
         Optional<ItemStack> stack = ItemStack.CODEC.parse(registries.createSerializationContext(NbtOps.INSTANCE), nbt).resultOrPartial((s) -> {
-            ItemStack.LOGGER.error("Tried to load invalid item: '{}' " + nbt.toString(), s);
+            String nbtString = nbt.toString();
+            if (nbtString.length() > 1000) {
+                nbtString = nbtString.substring(0, 997) + "...";
+            }
+            ItemStack.LOGGER.error("Tried to load invalid item: '{}' " + nbtString, s);
         });
 
         if (hash != null) {
