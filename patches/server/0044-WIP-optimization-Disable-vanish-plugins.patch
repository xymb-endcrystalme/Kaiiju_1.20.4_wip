From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Xymb <xymb@endcrystal.me>
Date: Sun, 15 Sep 2024 14:31:50 +0200
Subject: [PATCH] WIP optimization: Disable vanish plugins


diff --git a/src/main/java/abomination/config/UnsupportedWipOptionsWillChange.java b/src/main/java/abomination/config/UnsupportedWipOptionsWillChange.java
index fe7be26f208aa25503cbe675d686bb8ce665e426..b8f4ee56f9d78b6efb5948aa7f32600e7b9e19e8 100644
--- a/src/main/java/abomination/config/UnsupportedWipOptionsWillChange.java
+++ b/src/main/java/abomination/config/UnsupportedWipOptionsWillChange.java
@@ -32,4 +32,5 @@ public class UnsupportedWipOptionsWillChange {
     public static boolean speedupGetNearestEntity = false;
 
     public static boolean disableAchievements = false;
+    public static boolean disableVanishPlugins = false;
 }
diff --git a/src/main/java/net/minecraft/server/level/ChunkMap.java b/src/main/java/net/minecraft/server/level/ChunkMap.java
index 9baa83ed6ac429e8a20085aef939f8027046ddcb..10428330fece90ae2f3d5006dca2ca4e794b9de9 100644
--- a/src/main/java/net/minecraft/server/level/ChunkMap.java
+++ b/src/main/java/net/minecraft/server/level/ChunkMap.java
@@ -1221,7 +1221,8 @@ public class ChunkMap extends ChunkStorage implements ChunkHolder.PlayerProvider
                 // Folia end - region threading
 
                 // CraftBukkit start - respect vanish API
-                if (flag && (!ca.spottedleaf.moonrise.common.util.TickThread.isTickThreadFor(player) || !player.getBukkitEntity().canSee(this.entity.getBukkitEntity()))) { // Paper - only consider hits // Folia - region threading
+                if (abomination.config.UnsupportedWipOptionsWillChange.disableVanishPlugins && flag) flag = true; // Abomination
+                else if (flag && (!ca.spottedleaf.moonrise.common.util.TickThread.isTickThreadFor(player) || !player.getBukkitEntity().canSee(this.entity.getBukkitEntity()))) { // Paper - only consider hits // Folia - region threading
                     flag = false;
                 }
                 // CraftBukkit end
